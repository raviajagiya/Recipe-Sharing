{% extends 'base.html' %}
{% block title %}{{ recipe.title }} - Recipe{% endblock %}
{% block content %}
<div class="container py-4">
  <div class="row">
    <!-- Image Column -->
    <div class="col-md-6 mb-3">
      <img src="{{ url_for('static', filename='uploads/' ~ recipe.image) if recipe.image else url_for('static', filename='uploads/default_recipe.png') }}"
           alt="{{ recipe.title }}"
           class="img-fluid rounded recipe-detail-img">
    </div>

    <!-- Info Column -->
    <div class="col-md-6">
      <h2>{{ recipe.title }}</h2>
      <p class="text-muted">Shared by {{ recipe.author.username }} • {{ recipe.created_at.strftime('%b %d, %Y') }}</p>
      <p>❤️ {{ recipe.likers|length if recipe.likers else 0 }} &nbsp; 💬 {{ recipe.comments|length if recipe.comments else 0 }}</p>
      <p>🍽 {{ recipe.type_of_dish }} &nbsp; ⏰ {{ recipe.time_of_eat }} &nbsp; 🈳 {{ recipe.language }}</p>
      {% if recipe.description %}
        <p class="mt-3">{{ recipe.description }}</p>
      {% endif %}
    </div>
  </div>

  <!-- Ingredients & Instructions -->
  <div class="row mt-4">
    <div class="col-md-6">
      <h5>Ingredients</h5>
      <ul>
        {% for item in recipe.ingredients.split('\n') %}
          {% if item.strip() %}
            <li>{{ item.strip() }}</li>
          {% endif %}
        {% endfor %}
      </ul>
    </div>
    <div class="col-md-6">
      <h5>Instructions</h5>
      <ol>
        {% for step in recipe.instructions.split('\n') %}
          {% if step.strip() %}
            <li>{{ step.strip() }}</li>
          {% endif %}
        {% endfor %}
      </ol>
    </div>
  </div>

  <!-- Comments Section -->
  <div class="mt-4">
    <h5>Comments ({{ recipe.comments|length if recipe.comments else 0 }})</h5>
    {% for c in recipe.comments %}
      <div class="mb-3">
        <strong>{{ c.user.username }}</strong> <small class="text-muted">{{ c.created_at.strftime('%b %d, %Y %H:%M') }}</small>
        <p>{{ c.content }}</p>
      </div>
    {% else %}
      <p class="text-muted">No comments yet.</p>
    {% endfor %}

    {% if current_user.is_authenticated %}
      <form method="POST" action="{{ url_for('recipes.add_comment', recipe_id=recipe.id) }}">
        {{ comment_form.hidden_tag() }}
        {{ render_field(comment_form.content) }}
        <button class="btn btn-sm btn-primary">Add Comment</button>
      </form>
    {% endif %}
  </div>
</div>
{% endblock %}
